<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 관리</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/members.css">
</head>

<body>
    <div class="container">
        <div class="members-header">
            <div>
                <h1>회원 관리</h1>
                <p class="subtitle">회원 등록, 조회, 수정</p>
            </div>
            <a href="/dashboard" class="btn btn-secondary">← 메인으로</a>
        </div>

        <div class="card">
            <div class="search-section">
                <input type="text" id="searchInput" placeholder="이름 또는 핸드폰 뒷자리 4자리 검색..."
                    onkeyup="handleSearchKeyup(event)">
                <button class="btn btn-primary" onclick="searchMembers()">검색</button>
            </div>

            <div class="actions-bar">
                <button class="btn btn-success" onclick="openAddModal()">회원 등록</button>
                <button class="btn btn-warning" onclick="openExcelModal()">엑셀 일괄등록</button>
            </div>

            <div class="members-table" id="membersTable">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>로딩 중...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 회원 등록/수정 모달 -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">회원 등록</h2>
            </div>
            <form id="memberForm" onsubmit="saveMember(event)">
                <div class="form-group">
                    <label>이름</label>
                    <input type="text" id="memberName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>핸드폰번호</label>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div
                            style="padding: 12px; background: #ecf0f1; border-radius: 6px; font-weight: 600; color: #7f8c8d;">
                            010-</div>
                        <input type="tel" id="memberPhone" class="form-control" placeholder="0000-0000" maxlength="9"
                            required style="flex: 1;">
                    </div>
                </div>
                <div class="form-group">
                    <label>바코드 (선택)</label>
                    <input type="text" id="memberBarcode" class="form-control" placeholder="바코드 스캔 또는 입력">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('memberModal')">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 엑셀 업로드 모달 -->
    <div id="excelModal" class="modal">
        <!-- ... existing excel modal content ... -->
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>엑셀 일괄등록</h2>
            </div>
            <div>
                <div class="alert alert-info">
                    <strong>엑셀 파일 형식:</strong><br>
                    1열: 이름, 2열: 핸드폰번호 (010-0000-0000 또는 01000000000)<br>
                    첫 번째 행은 헤더로 간주되어 스킵됩니다.
                </div>
                <div class="form-group">
                    <label>엑셀 파일 선택</label>
                    <input type="file" id="excelFile" class="form-control" accept=".xlsx,.xls">
                </div>
                <button class="btn btn-primary" onclick="uploadExcel()">검수하기</button>

                <div id="excelResult" style="display:none; margin-top:20px;">
                    <h3>검수 결과</h3>
                    <div id="excelSummary" class="alert alert-info"></div>

                    <div id="invalidList" style="display:none;">
                        <h4 style="color:#e74c3c; margin-bottom:10px;">오류 목록</h4>
                        <div
                            style="max-height:200px; overflow-y:auto; border:1px solid #ecf0f1; border-radius:6px; padding:10px; background:#f8f9fa;">
                            <table class="table" style="font-size:12px;">
                                <thead>
                                    <tr>
                                        <th>행</th>
                                        <th>이름</th>
                                        <th>핸드폰</th>
                                        <th>오류</th>
                                    </tr>
                                </thead>
                                <tbody id="invalidTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <button class="btn btn-success" id="confirmExcelBtn" style="margin-top:15px;"
                        onclick="confirmExcelUpload()">
                        최종 등록
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('excelModal')">닫기</button>
            </div>
        </div>
    </div>

    <!-- 알림 모달 -->
    <div id="notificationModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-header" style="justify-content: center; border-bottom: none;">
                <h3>알림</h3>
            </div>
            <div class="modal-body" style="padding: 20px 0;">
                <p id="notificationMessage" style="font-size: 16px; margin: 0;"></p>
            </div>
            <div class="modal-footer" style="justify-content: center; border-top: none;">
                <button class="btn btn-primary" onclick="closeModal('notificationModal')">확인</button>
            </div>
        </div>
    </div>

    <script src="/static/js/members.js"></script>
</body>

</html>