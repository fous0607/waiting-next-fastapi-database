<div id="analyticsDashboardContainer" style="display: none; padding: 24px;">
    <!-- Top Header & Controls -->
    <div style="margin-bottom: 32px;">
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
            <button onclick="showDashboard('summary')"
                style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; border: 1px solid #e5e8eb; background: white; cursor: pointer; transition: all 0.2s;"
                onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'"
                title="메인 대시보드로">
                <i class="fas fa-home" style="color: #333d4b; font-size: 18px;"></i>
            </button>
            <h2 style="font-size: 26px; font-weight: 700; color: #191f28; margin: 0;">대시보드</h2>
        </div>

        <!-- Controls Row 1: Date Filter -->
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
            <div class="toss-date-group" id="analyticsDateQuickGroups">
                <button class="toss-choice-chip" data-range="yesterday">어제</button>
                <button class="toss-choice-chip active" data-range="today">오늘</button>
                <button class="toss-choice-chip" data-range="this_week">이번 주</button>
                <button class="toss-choice-chip" data-range="this_month">이번 달</button>
                <button class="toss-choice-chip" data-range="all">올해</button>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div class="toss-date-picker-trigger" onclick="openStartDatePicker()" style="min-width: 140px;">
                    <i class="far fa-calendar"></i>
                    <span id="analyticsStartDateDisplay">2025-02-27</span>
                </div>
                <span style="color: #8b95a1;">~</span>
                <div class="toss-date-picker-trigger" onclick="openEndDatePicker()" style="min-width: 140px;">
                    <i class="far fa-calendar"></i>
                    <span id="analyticsEndDateDisplay">2025-02-27</span>
                </div>
            </div>
            <!-- Hidden inputs -->
            <input type="date" id="analyticsStartDateInput" class="date-input-hidden">
            <input type="date" id="analyticsEndDateInput" class="date-input-hidden">
        </div>

        <!-- Controls Row 2: Store Filter & Comparison -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <!-- Store Dropdown -->
            <div class="toss-dropdown-trigger" style="min-width: 240px;">
                <i class="fas fa-store" style="color: #333d4b;"></i>
                <select id="analyticsStoreFilter" onchange="loadAnalyticsData()"
                    style="border: none; background: transparent; font-size: 16px; font-weight: 600; color: #333d4b; width: 100%; outline: none; cursor: pointer;">
                    <option value="">전체 매장 13개</option>
                </select>
                <i class="fas fa-chevron-down" style="color: #8b95a1;"></i>
            </div>

            <!-- Comparison Toggle -->
            <div class="toss-toggle-group">
                <button class="toss-toggle-btn active">지난주 대비</button>
                <button class="toss-toggle-btn">전년 동일대비</button>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="stats-grid"
        style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
        <div class="toss-stat-card">
            <div class="card-label">총 대기</div>
            <div class="card-value" id="ana-total-waiting">0명</div>
            <div class="card-compare negative">
                지난주 대비 <span id="ana-diff-waiting">-</span>
            </div>
        </div>
        <div class="toss-stat-card">
            <div class="card-label">입장 완료</div>
            <div class="card-value" id="ana-total-attendance">0명</div>
            <div class="card-compare negative">
                지난주 대비 <span id="ana-diff-attendance">-</span>
            </div>
        </div>
        <div class="toss-stat-card">
            <div class="card-label">취소 건수</div>
            <div class="card-value" id="ana-total-cancelled">0건</div>
            <div class="card-compare negative">
                지난주 대비 <span id="ana-diff-cancelled">-</span>
            </div>
        </div>
        <div class="toss-stat-card">
            <div class="card-label">평균 대기</div>
            <div class="card-value" id="ana-avg-wait">0분</div>
            <div class="card-compare positive">
                지난주 대비 <span id="ana-diff-wait">-</span>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="toss-card" style="padding: 24px; margin-bottom: 24px;">
        <div class="card-title" style="margin-bottom: 24px;">기간별 추이</div>
        <div style="height: 320px; position: relative;">
            <canvas id="hourlyTrendChart"></canvas>
            <div style="text-align: center; margin-top: 10px; font-size: 13px; color: #6b7684;">
                <span style="color: #3182f6;">● 오늘</span>
                <span style="color: #b0b8c1; margin-left: 10px;">● 지난주</span>
            </div>
        </div>
    </div>

    <!-- Bottom List (Store Details) -->
    <div class="toss-card" style="margin-bottom: 24px;">
        <div class="card-title" style="padding: 24px 24px 0 24px;">매장별 상세</div>
        <div class="table-container" style="padding: 24px;">
            <table class="toss-table">
                <thead>
                    <tr>
                        <th>매장명</th>
                        <th>상태</th>
                        <th>현재 대기</th>
                        <th>총 접수</th>
                        <th>입장</th>
                        <th>취소</th>
                    </tr>
                </thead>
                <tbody id="analyticsTableBody">
                    <!-- JS Populated -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Doughnut Charts Row -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <div class="toss-card" style="padding: 24px;">
            <div class="card-title" style="margin-bottom: 24px;">유입 채널 점유율</div>
            <div style="height: 250px; position: relative; display: flex; justify-content: center;">
                <canvas id="channelShareChart"></canvas>
            </div>
            <!-- Custom Legend Container -->
            <div id="channelLegend" style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <!-- Populated by JS -->
            </div>
        </div>
        <div class="toss-card" style="padding: 24px;">
            <div class="card-title" style="margin-bottom: 24px;">고객 유형 점유율</div>
            <div style="height: 250px; position: relative; display: flex; justify-content: center;">
                <canvas id="typeShareChart"></canvas>
            </div>
            <!-- Custom Legend Container -->
            <div id="typeLegend" style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>
</div>

<style>
    /* Toss Style Overrides */
    .toss-choice-chip {
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #e5e8eb;
        background: white;
        color: #6b7684;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .toss-choice-chip:hover {
        background-color: #f9fafb;
    }

    .toss-choice-chip.active {
        background-color: #3182f6;
        color: white;
        border-color: #3182f6;
        font-weight: 600;
    }

    .toss-date-picker-trigger {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: #f9fafb;
        border-radius: 8px;
        color: #4e5968;
        font-size: 14px;
        cursor: pointer;
    }

    .toss-dropdown-trigger {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        background: white;
        border-radius: 12px;
        border: 1px solid #e5e8eb;
        /* Or none if purely like image */
        /* Image has just text and arrow, maybe no border? Assume clean style */
        border: none;
    }

    .toss-dropdown-trigger:hover {
        background-color: #f2f4f6;
    }

    .toss-toggle-group {
        display: flex;
        background: #f2f4f6;
        /* Light gray bg */
        padding: 4px;
        border-radius: 8px;
    }

    .toss-toggle-btn {
        padding: 6px 12px;
        font-size: 13px;
        font-weight: 600;
        color: #8b95a1;
        background: transparent;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

    .toss-toggle-btn.active {
        background: white;
        color: #333d4b;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .toss-stat-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
        border: 1px solid #f2f4f6;
    }

    .card-label {
        font-size: 14px;
        color: #6b7684;
        margin-bottom: 12px;
        font-weight: 500;
    }

    .card-value {
        font-size: 24px;
        font-weight: 700;
        color: #191f28;
        margin-bottom: 8px;
    }

    .card-compare {
        font-size: 13px;
        color: #8b95a1;
    }

    .card-compare.negative {
        color: #f04452;
        /* Red */
    }

    .card-compare.positive {
        color: #2ecc71;
        /* Green... typically red is bad? context matters. */
    }

    .toss-card {
        background: white;
        border-radius: 20px;
        border: 1px solid #f2f4f6;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        color: #191f28;
    }
</style>