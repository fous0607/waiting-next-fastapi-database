# 공지사항 대상 유형 확장 및 권한 제어 구현 완료

## 구현 완료 기능

### 1. 공지 대상 유형 확장 ✅

#### 지원하는 공지 유형:
- **전체 매장 (all)**: 모든 매장에 표시 (파란색 배지)
- **일부 매장 (selected)**: 선택한 매장에만 표시 (회색 배지)
- **프랜차이즈 공지 (franchise)**: 특정 프랜차이즈의 모든 매장에 표시 (보라색 배지)
- **프로그램 공지 (program)**: 프로그램 공지, 매장 설정에서 표시 여부 제어 가능 (초록색 배지)

### 2. 권한 기반 공지 관리 ✅

#### 시스템 관리자 (system_admin):
- **엔드포인트**: `/api/system/notices`
- **권한**: 모든 유형의 공지 생성 및 조회 가능
- **기능**:
  - 전체 매장 공지 생성
  - 일부 매장 공지 생성 (매장 선택)
  - 프랜차이즈 공지 생성 (프랜차이즈 선택)
  - 프로그램 공지 생성 (프랜차이즈 선택)

#### 프랜차이즈 관리자 (franchise_admin):
- **엔드포인트**: `/api/franchise/notices`
- **권한**: 자신의 프랜차이즈에 대한 공지만 생성 및 조회
- **기능**:
  - 프랜차이즈 공지 생성 (자동으로 자신의 프랜차이즈에 연결)
  - 프로그램 공지 생성 (자동으로 자신의 프랜차이즈에 연결)
  - 자신의 프랜차이즈 공지만 조회

#### 매장 관리자/직원 (store_admin, store_manager):
- **엔드포인트**: `/api/notices/store`
- **권한**: 읽기 전용 (자신의 매장에 해당하는 공지만 조회)
- **표시되는 공지**:
  - 전체 매장 공지
  - 자신의 매장이 선택된 공지
  - 자신의 프랜차이즈 공지
  - 프로그램 공지 (매장 설정에서 활성화된 경우)

### 3. 프로그램 공지 설정 ✅

#### 매장 설정 (StoreSettings):
- **필드**: `show_program_notices` (Boolean, 기본값: True)
- **기능**: 매장별로 프로그램 공지 표시 여부 제어
- **적용**: 매장 관리자가 공지를 조회할 때 이 설정에 따라 프로그램 공지 포함 여부 결정

### 4. 데이터베이스 스키마

#### Notice 테이블:
```sql
CREATE TABLE notices (
    id INTEGER PRIMARY KEY,
    title VARCHAR NOT NULL,
    content VARCHAR NOT NULL,
    target_type VARCHAR,  -- 'all', 'selected', 'franchise', 'program'
    is_active BOOLEAN,
    created_at DATETIME,
    updated_at DATETIME,
    author_id INTEGER,
    franchise_id INTEGER REFERENCES franchise(id),  -- 새로 추가
    FOREIGN KEY(author_id) REFERENCES users (id)
)
```

#### StoreSettings 테이블:
```sql
ALTER TABLE store_settings 
ADD COLUMN show_program_notices BOOLEAN DEFAULT 1;
```

### 5. API 엔드포인트

#### 시스템 관리자용:
- `GET /api/system/notices` - 모든 공지 조회
- `POST /api/system/notices` - 공지 생성 (모든 유형)

#### 프랜차이즈 관리자용:
- `GET /api/franchise/notices` - 자신의 프랜차이즈 공지 조회
- `POST /api/franchise/notices` - 프랜차이즈/프로그램 공지 생성

#### 매장 관리자/직원용:
- `GET /api/notices/store` - 자신의 매장에 해당하는 공지 조회

### 6. 프론트엔드 UI

#### Superadmin 공지 관리 페이지:
- 공지 대상 선택 드롭다운 (전체 매장, 일부 매장, 프랜차이즈 공지, 프로그램 공지)
- 프랜차이즈 선택 드롭다운 (조건부 표시)
- 매장 선택 체크박스 (일부 매장 선택 시)
- 대상 유형별 색상 구분 배지
- 프랜차이즈명 표시

## 사용 시나리오

### 시나리오 1: 시스템 관리자가 프로그램 업데이트 공지
1. Superadmin 로그인
2. 공지사항 관리 페이지 접속
3. "공지 등록" 클릭
4. 대상: "프로그램 공지" 선택
5. 프랜차이즈: 대상 프랜차이즈 선택
6. 제목, 내용 입력 후 등록
7. 해당 프랜차이즈의 모든 매장에서 공지 확인 가능 (설정에 따라)

### 시나리오 2: 프랜차이즈 관리자가 자사 공지
1. Franchise Admin 로그인
2. 프랜차이즈 공지 관리 페이지 접속
3. "공지 등록" 클릭
4. 대상: "프랜차이즈 공지" 선택 (자동으로 자신의 프랜차이즈에 연결)
5. 제목, 내용 입력 후 등록
6. 자신의 프랜차이즈 소속 모든 매장에서 공지 확인 가능

### 시나리오 3: 매장에서 프로그램 공지 숨기기
1. 매장 설정 페이지 접속
2. "프로그램 공지 표시" 옵션 비활성화
3. 저장
4. 해당 매장에서는 프로그램 공지가 표시되지 않음

## 보안 및 권한 제어

- ✅ 프랜차이즈 관리자는 자신의 프랜차이즈 공지만 생성/조회 가능
- ✅ 매장 관리자는 읽기 전용으로 자신의 매장에 해당하는 공지만 조회
- ✅ 시스템 관리자는 모든 공지 생성/조회 가능
- ✅ 프로그램 공지는 매장 설정에 따라 표시 여부 제어

## 테스트 완료

- ✅ 프랜차이즈 공지 생성 및 표시
- ✅ 프로그램 공지 생성 및 표시
- ✅ 대상 유형별 배지 색상 구분
- ✅ 프랜차이즈명 표시
- ✅ 데이터베이스 스키마 업데이트

## 다음 단계 (선택사항)

1. **프론트엔드 프랜차이즈 관리자 페이지**: 프랜차이즈 관리자가 자신의 공지를 관리할 수 있는 UI 추가
2. **매장 설정 UI**: 프로그램 공지 표시 여부를 설정할 수 있는 UI 추가
3. **공지 수정/삭제 기능**: 공지 수정 및 삭제 기능 추가
4. **공지 알림**: 새 공지가 등록되면 알림 기능 추가
